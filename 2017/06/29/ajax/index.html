<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Javascript,web开发,AJAX," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="一、AJAX 跨域 背景：在JavaScript中，有一个很重要的安全性限制，被称为“Same-Origin Policy”（同源策略）。这一策略对于JavaScript代码能够访问的页面内容做了很重要的限制，即JavaScript只能访问与包含它的文档在同一域下的内容。">
<meta name="keywords" content="Javascript,web开发,AJAX">
<meta property="og:type" content="article">
<meta property="og:title" content="跨域-AJAX">
<meta property="og:url" content="https://github.com/jing0816/jing0816.github.io.git/2017/06/29/ajax/index.html">
<meta property="og:site_name" content="前端日常">
<meta property="og:description" content="一、AJAX 跨域 背景：在JavaScript中，有一个很重要的安全性限制，被称为“Same-Origin Policy”（同源策略）。这一策略对于JavaScript代码能够访问的页面内容做了很重要的限制，即JavaScript只能访问与包含它的文档在同一域下的内容。">
<meta property="og:image" content="http://images.cnitblog.com/blog/130623/201307/15184526-1cfb09aa81c742c3bc80e56474ed4e74.png">
<meta property="og:image" content="http://images.cnitblog.com/blog/386062/201212/22095949-5c488ac900274775b1f3cb93cc0f17c2.png">
<meta property="og:image" content="http://chuantu.biz/t5/119/1498614629x2084677658.png">
<meta property="og:image" content="http://chuantu.biz/t5/119/1498648032x2084677658.png">
<meta property="og:image" content="http://chuantu.biz/t5/119/1498647937x2084677658.png">
<meta property="og:image" content="http://chuantu.biz/t5/119/1498648195x2084677658.png">
<meta property="og:image" content="http://chuantu.biz/t5/120/1498714064x2084677658.png">
<meta property="og:image" content="http://chuantu.biz/t5/120/1498722260x2084677658.png">
<meta property="og:image" content="http://chuantu.biz/t5/120/1498722132x2084677658.png">
<meta property="og:image" content="http://chuantu.biz/t5/120/1498721983x2084677658.png">
<meta property="og:updated_time" content="2017-06-29T09:53:43.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="跨域-AJAX">
<meta name="twitter:description" content="一、AJAX 跨域 背景：在JavaScript中，有一个很重要的安全性限制，被称为“Same-Origin Policy”（同源策略）。这一策略对于JavaScript代码能够访问的页面内容做了很重要的限制，即JavaScript只能访问与包含它的文档在同一域下的内容。">
<meta name="twitter:image" content="http://images.cnitblog.com/blog/130623/201307/15184526-1cfb09aa81c742c3bc80e56474ed4e74.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://github.com/jing0816/jing0816.github.io.git/2017/06/29/ajax/"/>





  <title>跨域-AJAX | 前端日常</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">前端日常</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://github.com/jing0816/jing0816.github.io.git/2017/06/29/ajax/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端日常">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">跨域-AJAX</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-29T15:50:19+08:00">
                2017-06-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Javascript/" itemprop="url" rel="index">
                    <span itemprop="name">Javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="一、AJAX-跨域"><a href="#一、AJAX-跨域" class="headerlink" title="一、AJAX 跨域"></a>一、AJAX 跨域</h3><blockquote>
<p>背景：<br>在JavaScript中，有一个很重要的安全性限制，被称为“Same-Origin Policy”（同源策略）。这一策略对于JavaScript代码能够访问的页面内容做了很重要的限制，即JavaScript只能访问与包含它的文档在同一域下的内容。<br><a id="more"></a></p>
<p>对于Ajax的影响在于，通过XMLHttpRequest实现的Ajax请求，不能向不同的域提交请求。</p>
<p>比如用ajax向一个不同的域请求数据，或者通过js获取页面中不同域的框架中(iframe)的数据。只要协议、域名、端口有任何一个不同，都被当作是不同的域。</p>
<p>下表给出了相对<a href="http://store.company.com/dir/page.html同源检测的结果" target="_blank" rel="external">http://store.company.com/dir/page.html同源检测的结果</a>:</p>
</blockquote>
<p><img src="http://images.cnitblog.com/blog/130623/201307/15184526-1cfb09aa81c742c3bc80e56474ed4e74.png" alt="avatar"></p>
<ul>
<li><p>Xhr</p>
<p>XHR英文全名XmlHttpRequest，中文可以解释为可扩展超文本传输请求。Xml可扩展标记语言，Http超文本传输协议，Request请求。XMLHttpRequest对象可以在不向服务器提交整个页面的情况下，实现局部更新网页。当页面全部加载完毕后，客户端通过该对象向服务器请求数据，服务器端接受数据并处理后，向客户端反馈数据。 XMLHttpRequest 对象提供了对 HTTP 协议的完全的访问，包括做出 POST 和 HEAD 请求以及普通的 GET 请求的能力。XMLHttpRequest 可以同步或异步返回 Web 服务器的响应，并且能以文本或者一个 DOM 文档形式返回内容。尽管名为 XMLHttpRequest，它并不限于和 XML 文档一起使用：它可以接收任何形式的文本文档。XMLHttpRequest 对象是名为 AJAX 的 Web 应用程序架构的一项关键功能。</p>
</li>
</ul>
<h3 id="二、AJAX跨域解决方案"><a href="#二、AJAX跨域解决方案" class="headerlink" title="二、AJAX跨域解决方案"></a>二、AJAX跨域解决方案</h3><h4 id="一、代理"><a href="#一、代理" class="headerlink" title="一、代理"></a>一、代理</h4><p>这种方式是通过后台(ASP、PHP、JAVA、ASP.NET)获取其他域名下的内容，然后再把获得内容返回到前端，这样因为在同一个域名下，所以就不会出现跨域的问题。</p>
<p>比如在A（www.a.com/sever.php）和B（www.b.com/sever.php）各有一个服务器，A的后端（www.a.com/sever.php）直接访问B的服务，然后把获取的响应值返回给前端。也就是A的服务在后台做了一个代理，前端只需要访问A的服务器也就相当与访问了B的服务器。这种代理属于后台的技术，所以不多说了，哈哈哈哈😄😄😄。</p>
<h4 id="二、XHR2"><a href="#二、XHR2" class="headerlink" title="二、XHR2"></a>二、XHR2</h4><h5 id="1-XMLHttpRequest-Level2-背景"><a href="#1-XMLHttpRequest-Level2-背景" class="headerlink" title="1.XMLHttpRequest Level2 背景"></a>1.XMLHttpRequest Level2 背景</h5><blockquote>
<p>由于同源限制(same-origin policy)，以前XMLHttpRequest(XHR) 只能同源通讯，不能进行跨源资源共享(Cross-Origin Resource Sharing,CORS) 。由于HTML 5的概念形成，在原有XHR的基础上提出了XMLHttpRequest Level2(XHR2)，在XHR2中对CORS有了很好的支持。</p>
<p>当前浏览器对XHR2支持情况：<a href="http://caniuse.com/xhr2" target="_blank" rel="external">查看</a></p>
</blockquote>
<p><img src="http://images.cnitblog.com/blog/386062/201212/22095949-5c488ac900274775b1f3cb93cc0f17c2.png" alt="avatar"></p>
<h5 id="2-CORS"><a href="#2-CORS" class="headerlink" title="2. CORS"></a>2. CORS</h5><blockquote>
<p>CORS背后的基本思想是使用自定义HTTP标头来允许浏览器和服务器彼此了解足够的信息，以确定请求或响应是否应该成功或失败。对于一个简单的请求，使用GET或POST与 没有自定义标头，其主体是文本/简单的，请求被发送带有称为Origin的额外标题。 Origin标头包含请求页面的源（协议，域名和端口），以便服务器可以轻松地确定它是否应该提供响应。</p>
<p>跨原始资源共享标准的工作原理是添加新的HTTP标头，允许服务器描述允许使用Web浏览器读取信息的一组起源。 另外，对于可能对用户数据造成副作用的HTTP请求方法（特别是对于除GET之外的HTTP方法，或者使用某些MIME类型的POST方式）的HTTP请求方法，规范要求浏览器“预检”请求，请求支持的方法 从具有HTTPOPTIONS请求头的服务器，然后在服务器“批准”之后，使用实际的HTTP请求方法发送实际请求。 服务器还可以通知客户端是否应发送“凭据”（包括Cookie和HTTP验证数据）以及request。</p>
</blockquote>
<p>简单来说，服务器首先要具备对CORS支持，这样浏览器才能对该服务器进行跨源访问。如果服务器允许某个源对其访问，则体现在HTTP响应的头部。有没有：Access-Control-Allow-Origin:*。</p>
<h5 id="3-实现"><a href="#3-实现" class="headerlink" title="3. 实现"></a>3. 实现</h5><ul>
<li>只需要在服务器端头部加上下面两句代码：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">header( &quot;Access-Control-Allow-Origin:*&quot; );</div><div class="line"></div><div class="line">header(&quot;Access-Control-Allow-Origin: http:www.test1.com&quot;);</div><div class="line"></div><div class="line">header( &quot;Access-Control-Allow-Methods:POST,GET&quot; );</div></pre></td></tr></table></figure>
<p>当前我设置的header为“<em>”，任意一个请求过来之后服务端我们都可以进行处理&amp;响应，那么在调试工具中可以看到其头信息设置，其中见红框中有一项信息是`Access-Control-Allow-Origin：</em> `，表示我们已经启用CORS。</p>
<ul>
<li>前端</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">//跨域请求方法示例</div><div class="line">  function ajaxPost()&#123;</div><div class="line">        var xhr = new XMLHttpRequest();</div><div class="line">      if (xhr.withCredentials === undefined) &#123;</div><div class="line">          return;</div><div class="line">        &#125;</div><div class="line">    //示例为POST请求</div><div class="line">        xhr.open(&quot;POST&quot;, &quot;http://localhost:8080/sendMsg&quot;);</div><div class="line">    //当为post请求时，这段话必须要添加，否则post过去的数据无法正常接收</div><div class="line">        xhr.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded;charset=UTF-8&quot;);</div><div class="line"></div><div class="line">        xhr.onreadystatechange = function () &#123;</div><div class="line">      if (xhr.readyState !== 4) return;//忽略未完成的调用</div><div class="line">      if (xhr.status === 200) &#123;</div><div class="line">        //知道为什么这边接受到的返回值是字符串类型，手动转成json格式，不过这里没有考虑兼容性问题，只是做一个简单的演示</div><div class="line">        var data = JSON.parse(xhr.responseText);</div><div class="line">        alert(data.msg);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    //发送请求，并post提交的参数</div><div class="line">      xhr.send(&quot;datas=1231232&quot;);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>服务器端代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;sendMsg&quot;)</div><div class="line">  @ResponseBody</div><div class="line">  public Json sendMsg(HttpServletResponse response, String datas)&#123;</div><div class="line">    Json json = new Json();</div><div class="line">    json.setSuccess(true);</div><div class="line">    json.setMsg(&quot;获取数据成功&quot;);</div><div class="line">    </div><div class="line">    System.out.println(datas);</div><div class="line">    </div><div class="line">    //这里需要设置头信息，不然客户端无法接收到返回值</div><div class="line">    response.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</div><div class="line">    response.setHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;POST&quot;);</div><div class="line">    response.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;x-requested-with,content-type&quot;);</div><div class="line">    </div><div class="line">      return json;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h4 id="三、jsonp"><a href="#三、jsonp" class="headerlink" title="三、jsonp"></a>三、jsonp</h4><h5 id="1-Jsonp原理："><a href="#1-Jsonp原理：" class="headerlink" title="1.Jsonp原理："></a>1.Jsonp原理：</h5><blockquote>
<p>JSONP是JSON with Padding的简写，是应用JSON实现服务器与客户端跨源通信的常用方法。最大特点就是简单适用，老式浏览器全部支持，服务器改造非常小。</p>
<p>它的基本思想是，网页通过添加一个<code>&lt;script&gt;</code>元素，向服务器请求JSON数据，这种做法不受同源政策限制；服务器收到请求后，将数据放在一个指定名字的回调函数里传回来。JSOP包含两部分：回调函数和数据，回调函数是在响应到来时应该调用的函数，一般通过查询字符串添加；数据就是传入回调函数中的JSON数据，确切的说，是一个JSON对象，可以直接访问。</p>
</blockquote>
<ol>
<li>ajax本身是不可以跨域的，通过产生一个script标签来实现跨域。因为script标签的src属性是没有跨域的限制的。 </li>
<li>首先在客户端注册一个callback, 然后把callback的名字传给服务器。<br>此时，服务器先生成 json 数据。</li>
<li>然后以 javascript 语法的方式，生成一个function , function 名字就是传递上来的参数 jsonp.</li>
<li>最后将 json 数据直接以入参的方式，放置到 function 中，这样就生成了一段 js 语法的文档，返回给客户端。</li>
<li>客户端浏览器，解析script标签，并执行返回的 javascript 文档，此时数据作为参数，传入到了客户端预先定义好的 callback 函数里.（动态执行回调函数）</li>
</ol>
<p>其实设置了<code>dataType: &#39;jsonp&#39;</code>后，<code>$.ajax</code>方法就和ajax XmlHttpRequest没什么关系了，取而代之的则是JSONP协议。JSONP是一个非官方的协议，它允许在服务器端集成Script tags返回至客户端，通过javascript callback的形式实现跨域访问。</p>
<h5 id="2-json-与jsonp的区别"><a href="#2-json-与jsonp的区别" class="headerlink" title="2.json 与jsonp的区别:"></a>2.json 与jsonp的区别:</h5><p>　JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式。<br>　JSONP是JSON with Padding的略称。它是一个非官方的协议，它允许在服务器端集成Script tags返回至客户端，通过javascript callback的形式实现跨域访问（这仅仅是JSONP简单的实现形式）。</p>
<p>　JSONP就像是JSON+Padding一样(Padding这里我们理解为填充)，<br>在js中，我们直接用XMLHttpRequest请求不同域上的数据时，是不可以的。但是，在页面上引入不同域上的js脚本文件却是可以的，jsonp正是利用这个特性来实现的。</p>
<p>json格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;message&quot;:&quot;获取成功&quot;,</div><div class="line">    &quot;state&quot;:&quot;1&quot;,</div><div class="line">    &quot;result&quot;:&#123;&quot;name&quot;:&quot;工作组1&quot;,&quot;id&quot;:1,&quot;description&quot;:&quot;11&quot;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jsonp格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">callback(&#123;</div><div class="line">    &quot;message&quot;:&quot;获取成功&quot;,</div><div class="line">    &quot;state&quot;:&quot;1&quot;,</div><div class="line">    &quot;result&quot;:&#123;&quot;name&quot;:&quot;工作组1&quot;,&quot;id&quot;:1,&quot;description&quot;:&quot;11&quot;&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h5 id="3-Jsonp跨域实现："><a href="#3-Jsonp跨域实现：" class="headerlink" title="3.Jsonp跨域实现："></a>3.Jsonp跨域实现：</h5><p>比如，有个a.html页面，它里面的代码需要利用ajax获取一个不同域上的json数据，假设这个json数据地址是<a href="http://example.com/data.php,那么a.html中的代码就可以这样：" target="_blank" rel="external">http://example.com/data.php,那么a.html中的代码就可以这样：</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$.ajax(&#123;</div><div class="line">  url: &apos;http://portal.lietou.com/loginscore/get-employee-loginscore.json&apos;,</div><div class="line">  type: &apos;post&apos;,</div><div class="line">  dataType: &apos;jsonp&apos;,</div><div class="line">  success(data) &#123;</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>如图：<br><img src="http://chuantu.biz/t5/119/1498614629x2084677658.png" alt="avatar"><br>请求地址以及返回：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Request URL:</div><div class="line"> http://portal.lietou.com/loginscore/get-employee-loginscore.json?callback=jQuery171034674236820559856_1498552690325&amp;_=1498552690701</div><div class="line"></div><div class="line">返回：</div><div class="line">jQuery171034674236820559856_1498552690325(&#123;</div><div class="line">  &quot;data&quot;:&#123;</div><div class="line">    &quot;employeeId&quot;:346,</div><div class="line">    &quot;rightTime&quot;:false,</div><div class="line">    &quot;rightLogin&quot;:true</div><div class="line">   &#125;,</div><div class="line">  &quot;flag&quot;:1</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>我们看到获取数据的地址后面还有一个callback参数，按惯例是用这个参数名，但是你用其他的也一样。因为是当做一个js文件来引入的，所以服务器返回的必须是一个能执行的js文件</p>
<p>所以通过<a href="http://portal.lietou.com/loginscore/get-employee-loginscore.json?callback=jQuery171034674236820559856_1498552690325&amp;_=1498552690701得到的js文件，就是定义的jQuery171034674236820559856_1498552690325函数,并且它的参数就是我们需要的json数据，这样我们就跨域获得了我们需要的数据。" target="_blank" rel="external">http://portal.lietou.com/loginscore/get-employee-loginscore.json?callback=jQuery171034674236820559856_1498552690325&amp;_=1498552690701得到的js文件，就是定义的jQuery171034674236820559856_1498552690325函数,并且它的参数就是我们需要的json数据，这样我们就跨域获得了我们需要的数据。</a></p>
<p> <strong>这样jsonp的原理就很清楚了，通过script标签引入一个js文件，这个js文件载入成功后会执行我们在url参数中指定的函数，并且会把我们需要的json数据作为参数传入。所以jsonp是需要服务器端的页面进行相应的配合的。</strong></p>
<p>原理是一样的，只不过我们不需要手动的插入script标签以及定义回掉函数。jquery会自动生成一个全局函数来替换callback=?中的问号，之后获取到数据后又会自动销毁，实际上就是起一个临时代理函数的作用。<code>$.getJSON</code>方法会自动判断是否跨域，不跨域的话，就调用普通的ajax方法；跨域的话，则会以异步加载js文件的形式来调用jsonp的回调函数。</p>
<h3 id="三、LT-Ajax"><a href="#三、LT-Ajax" class="headerlink" title="三、LT.Ajax"></a>三、LT.Ajax</h3><blockquote>
<p>依赖于jQuery的Crossdomain Ajax</p>
<p> Xhr<br>  XHR英文全名XmlHttpRequest，中文可以解释为可扩展超文本传输请求。Xml可扩展标记语言，Http超文本传输协议，Request请求。XMLHttpRequest对象可以在不向服务器提交整个页面的情况下，实现局部更新网页。当页面全部加载完毕后，客户端通过该对象向服务器请求数据，服务器端接受数据并处理后，向客户端反馈数据。 XMLHttpRequest 对象提供了对 HTTP 协议的完全的访问，包括做出 POST 和 HEAD 请求以及普通的 GET 请求的能力。XMLHttpRequest 可以同步或异步返回 Web 服务器的响应，并且能以文本或者一个 DOM 文档形式返回内容。尽管名为 XMLHttpRequest，它并不限于和 XML 文档一起使用：它可以接收任何形式的文本文档。XMLHttpRequest 对象是名为 AJAX 的 Web 应用程序架构的一项关键功能。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">LT.Ajax = LT.ajax = function(options) &#123;</div><div class="line">  LT.Object.extend(options, &#123;&#125;);</div><div class="line">  if (options.url.indexOf(&apos;//&apos;) === 0) &#123;</div><div class="line">    options.url = location.protocol + options.url;</div><div class="line">  &#125;</div><div class="line">  if (options.url.indexOf(&apos;http&apos;) !== 0) &#123;</div><div class="line">    options.url = location.protocol + &apos;//&apos; + location.hostname + (location.port ? (&apos;:&apos; + location.port) : &apos;&apos;) + (options.url.indexOf(&apos;/&apos;) === -1 ? (&apos;/&apos; + options.url) : options.url);</div><div class="line">  &#125;</div><div class="line">  var host = options.url.replace(/(https?:\/\/)?([^\/]+)(\s|\S)*/g, &apos;$2&apos;);</div><div class="line">  //获取ajax请求的url域名</div><div class="line">  LT.Domain.use(host, function() &#123;</div><div class="line">    $.ajax(options);</div><div class="line">  &#125;);</div><div class="line">  return this;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li>location的属性</li>
</ul>
<table>
<thead>
<tr>
<th>属性名</th>
<th style="text-align:center">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>locaton.hash</td>
<td style="text-align:center">返回从#的开始的url</td>
</tr>
<tr>
<td>location.hostname</td>
<td style="text-align:center">返回当前url的域名 <a href="https://m.liepin.com/zhaopin/" target="_blank" rel="external">https://m.liepin.com/zhaopin/</a>  m.liepin.com</td>
</tr>
<tr>
<td>location.pathname</td>
<td style="text-align:center">返回当前页面的路径和文件名(参数？No )</td>
</tr>
<tr>
<td>location.port</td>
<td style="text-align:center">返回当前url的端口号 （80 或 443）</td>
</tr>
<tr>
<td>location.protocol</td>
<td style="text-align:center">返回所使用的 web 协议（http: 或 https:）</td>
</tr>
<tr>
<td>location.href</td>
<td style="text-align:center">返回完整的url</td>
</tr>
<tr>
<td>location.search</td>
<td style="text-align:center">返回从？开始的url</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">location.pathname:</div><div class="line">  https://m.liepin.com/zhaopin/              /zhaopin/</div><div class="line">  https://c.liepin.com/?time=1498444829196        /</div></pre></td></tr></table></figure>
<ul>
<li>location的方法</li>
</ul>
<table>
<thead>
<tr>
<th>方法名</th>
<th style="text-align:center">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>location.assign()</td>
<td style="text-align:center">加载新的文档</td>
</tr>
<tr>
<td>location.reload()</td>
<td style="text-align:center">重新加载当前文档</td>
</tr>
<tr>
<td>location.replace()</td>
<td style="text-align:center">用新的文档替换当前文档</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">LT.Domain=&#123;</div><div class="line">_cross: function() &#123;</div><div class="line">    try &#123;</div><div class="line">      document.domain = window.location.hostname.split(&apos;.&apos;).reverse().slice(0, 2).reverse().join(&apos;.&apos;);</div><div class="line">      this._crossed = true;</div><div class="line">    &#125; catch (e) &#123;&#125;</div><div class="line">  &#125;,</div><div class="line"> proxies: &#123;&#125;,</div><div class="line"> use: function(hostname, callback) &#123;</div><div class="line">    var that = this;</div><div class="line">    if (!that.proxies.xhr) that.proxies.xhr = window.jQuery.ajaxSettings.xhr;</div><div class="line">    if (that._needCross(hostname)) &#123;</div><div class="line">      if (that.proxies[hostname] &amp;&amp; that.proxies[hostname].loaded&#123;</div><div class="line">        $.ajaxSetup(&#123;</div><div class="line">          crossDomain: false,</div><div class="line">          xhr: function() &#123;</div><div class="line">            if (this.dataType === &apos;script&apos;) return that.proxies.xhr();</div><div class="line">            if (that._root(this.url) === location.hostname) &#123;</div><div class="line">              return that.proxies.xhr();</div><div class="line">            &#125; else &#123;</div><div class="line">              return that.proxies[hostname].contentWindow.getTransport();</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;);</div><div class="line">        LT.ajaxExtend($.ajaxSettings, &apos;beforeSend&apos;, function (XHR) &#123;</div><div class="line">          XHR.setRequestHeader(&apos;X-Alt-Referer&apos;,location.href);</div><div class="line">        &#125;);</div><div class="line">        if (callback) callback.call(this);</div><div class="line">      &#125; else &#123;</div><div class="line">        LT.Domain.init(hostname, function(host) &#123;</div><div class="line">          LT.Domain.use(host, callback);</div><div class="line">        &#125;);</div><div class="line">      &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">      if (callback) callback.call(this);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>window.jQuery.ajaxSettings.xhr:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">function ci()&#123;</div><div class="line">  try&#123;</div><div class="line">   return new a.XMLHttpRequest</div><div class="line">  &#125;catch(b)&#123;</div><div class="line"> &#125;&#125;</div></pre></td></tr></table></figure>
<h4 id="一、ajaxSettings"><a href="#一、ajaxSettings" class="headerlink" title="一、ajaxSettings"></a>一、ajaxSettings</h4><ul>
<li>ajaxSettings:<br>来看看ajaxSettings的相关代码(辣么多😂😂)，这些都是相当于默认的配置属性，有些用来设置请求头的属性等等。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">ajaxSettings: &#123;</div><div class="line">  url: ajaxLocation,  //默认url为当前文档地址</div><div class="line">  type: &quot;GET&quot;, //默认get方式</div><div class="line">  isLocal: rlocalProtocol.test( ajaxLocParts[ 1 ] ),  //是否是本地文件系统 如：浏览器地址以file:///开头</div><div class="line">  global: true, //是否支持全局ajax事件</div><div class="line">  processData: true, //是否把data选项值处理成字符串形式。</div><div class="line">  async: true,//是否异步</div><div class="line">  contentType: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, //请求头中默认的contentType</div><div class="line">  /**</div><div class="line">  timeout: 0,</div><div class="line">  data: null,</div><div class="line">  dataType: null,</div><div class="line">  username: null,</div><div class="line">  password: null,</div><div class="line">  cache: null,</div><div class="line">  throws: false,  //设为true时转换错误时将错误throw</div><div class="line">  traditional: false,</div><div class="line">  headers: &#123;&#125;,</div><div class="line">  **/</div><div class="line">  //如果Ajax请求未设置具体的dataType,jQuery通过这个对象，根据使用正则来匹配响应头的content-type值，对应于正则的属性名就被认为是返回内容的数据类型。        </div><div class="line">  contents: &#123;</div><div class="line">      xml: /xml/,</div><div class="line">      html: /html/,</div><div class="line">      json: /json/</div><div class="line">  &#125;,</div><div class="line">  //响应对象中的字段到jqXHR对象中字段的映射        </div><div class="line">  responseFields: &#123;</div><div class="line">      xml: &quot;responseXML&quot;,</div><div class="line">      text: &quot;responseText&quot;</div><div class="line">  &#125;,</div><div class="line">  // Data converters</div><div class="line">  // Keys separate source (or catchall &quot;*&quot;) and destination types with a single space</div><div class="line">  //数据转换工具 </div><div class="line">  //例如 &quot;text json&quot;: jQuery.parseJSON  意思就是可以通过jQuery.parseJSON函数，将text类型的数据转换为json类型的数据        </div><div class="line">  converters: &#123;</div><div class="line">      // Convert anything to text</div><div class="line">      &quot;* text&quot;: window.String,</div><div class="line">      // Text to html (true = no transformation)</div><div class="line">      &quot;text html&quot;: true,</div><div class="line">      // Evaluate text as a json expression</div><div class="line">      &quot;text json&quot;: jQuery.parseJSON,</div><div class="line">      // Parse text as xml</div><div class="line">      &quot;text xml&quot;: jQuery.parseXML</div><div class="line">  &#125;,</div><div class="line">  // For options that shouldn&apos;t be deep extended:</div><div class="line">  // you can add your own custom options here if</div><div class="line">  // and when you create one that shouldn&apos;t be</div><div class="line">  // deep extended (see ajaxExtend)</div><div class="line">  //用来设置那些不应该被深扩展的属性</div><div class="line">  //ajaxExtend中用到        </div><div class="line">  flatOptions: &#123;</div><div class="line">      url: true,</div><div class="line">      context: true</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="二、jQuery-ajax"><a href="#二、jQuery-ajax" class="headerlink" title="二、jQuery.ajax"></a>二、jQuery.ajax</h4><h5 id="1、参数"><a href="#1、参数" class="headerlink" title="1、参数"></a>1、参数</h5><ol>
<li>options<ul>
<li>类型：Object</li>
<li>可选。AJAX 请求设置。所有选项都是可选的。</li>
</ul>
</li>
<li>async<ul>
<li>类型：Boolean</li>
<li>默认值: true。默认设置下，所有请求均为异步请求。如果需要发送同步请求，请将此选项设置为 false。</li>
<li>注意，同步请求将锁住浏览器，用户其它操作必须等待请求完成才可以执行。</li>
</ul>
</li>
<li>beforeSend(XHR)<ul>
<li>类型：Function</li>
<li>发送请求前可修改 XMLHttpRequest 对象的函数，如添加自定义 HTTP 头。</li>
</ul>
</li>
<li>XMLHttpRequest 对象是唯一的参数。<ul>
<li>这是一个 Ajax 事件。如果返回 false 可以取消本次 ajax 请求。</li>
</ul>
</li>
<li>cache（jQuery 1.2 新功能）<ul>
<li>类型：Boolean</li>
<li>默认值: true，dataType 为 script 和 jsonp 时默认为 false。设置为 false 将不缓存此页面。</li>
</ul>
</li>
<li>complete(XHR, TS)<ul>
<li>类型：Function</li>
<li>请求完成后回调函数 (请求成功或失败之后均调用)。</li>
<li>参数： XMLHttpRequest 对象和一个描述请求类型的字符串。</li>
<li>这是一个 Ajax 事件。</li>
</ul>
</li>
<li>contentType<ul>
<li>类型：String</li>
<li>默认值: “application/x-www-form-urlencoded”。发送信息至服务器时内容编码类型。</li>
<li>默认值适合大多数情况。如果你明确地传递了一个 content-type 给 <code>$.ajax()</code>那么它必定会发送给服务器（即使没有数据要发送）。</li>
</ul>
</li>
<li><p>context</p>
<ul>
<li>类型：Object</li>
<li>这个对象用于设置 Ajax 相关回调函数的上下文。也就是说，让回调函数内 this 指向这个对象（如果不设定这个参数，那么 this 就指向调用本次 AJAX 请求时传递的 options 参数）。比如指定一个 DOM 元素作为 context 参数，这样就设置了 success 回调函数的上下文为这个 DOM 元素。</li>
<li>就像这样：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$.ajax(&#123; </div><div class="line"> url: &quot;test.html&quot;, </div><div class="line"> context: document.body, </div><div class="line"> success: function()&#123;</div><div class="line">      $(this).addClass(&quot;done&quot;);</div><div class="line">  &#125;&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>data</p>
<ul>
<li>类型：String</li>
<li>发送到服务器的数据。将自动转换为请求字符串格式。GET 请求中将附加在 URL 后。查看 processData 选项说明以禁止此自动转换。必须为 Key/Value 格式。如果为数组，jQuery 将自动为不同值对应同一个名称。如 {foo:[“bar1”, “bar2”]} 转换为 ‘&amp;foo=bar1&amp;foo=bar2’。</li>
</ul>
</li>
<li>dataFilter<ul>
<li>类型：Function</li>
<li>给 Ajax 返回的原始数据的进行预处理的函数。提供 data 和 type 两个参数：data 是 Ajax 返回的原始数据，type 是调用 jQuery.ajax 时提供的 dataType 参数。函数返回的值将由 jQuery 进一步处理。</li>
</ul>
</li>
<li>dataType<ul>
<li>类型：String</li>
<li>预期服务器返回的数据类型。如果不指定，jQuery 将自动根据 HTTP 包 MIME 信息来智能判断，比如 XML MIME 类型就被识别为 XML。在 1.4 中，JSON 就会生成一个 JavaScript 对象，而 script 则会执行这个脚本。随后服务器端返回的数据会根据这个值解析后，传递给回调函数。可用值:<ul>
<li>“xml”: 返回 XML 文档，可用 jQuery 处理。</li>
<li>“html”: 返回纯文本 HTML 信息；包含的 script 标签会在插入 dom 时执行。</li>
<li>“script”: 返回纯文本 JavaScript 代码。不会自动缓存结果。除非设置了      </li>
<li>“cache” 参数。注意：在远程请求时(不在同一个域下)，所有 POST 请求都将转为 GET 请求。（因为将使用 DOM 的 script标签来加载）</li>
<li>“json”: 返回 JSON 数据 。</li>
<li>“jsonp”: JSONP 格式。使用 JSONP 形式调用函数时，如 “myurl?callback=?” jQuery 将自动替换 ? 为正确的函数名，以执行回调函数。</li>
<li>“text”: 返回纯文本字符串</li>
</ul>
</li>
</ul>
</li>
<li>error<ul>
<li>类型：Function</li>
<li>默认值: 自动判断 (xml 或 html)。请求失败时调用此函数。</li>
<li>有以下三个参数：XMLHttpRequest 对象、错误信息、（可选）捕获的异常对象。</li>
<li>如果发生了错误，错误信息（第二个参数）除了得到 null 之外，还可能是 “timeout”, “error”, “notmodified” 和 “parsererror”。</li>
<li>这是一个 Ajax 事件。</li>
</ul>
</li>
<li>global<ul>
<li>类型：Boolean</li>
<li>是否触发全局 AJAX 事件。</li>
<li>默认值: true。设置为 false 将不会触发全局 AJAX 事件，如 ajaxStart 或 ajaxStop 可用于控制不同的 Ajax 事件。</li>
</ul>
</li>
<li>ifModified<ul>
<li>类型：Boolean</li>
<li>仅在服务器数据改变时获取新数据。</li>
<li>默认值: false。</li>
<li>使用 HTTP 包 Last-Modified 头信息判断。在 jQuery 1.4 中，它也会检查服务器指定的 ‘etag’ 来确定数据没有被修改过。</li>
</ul>
</li>
<li>jsonp<ul>
<li>类型：String</li>
<li>在一个 jsonp 请求中重写回调函数的名字。这个值用来替代在 “callback=?” 这种 GET 或 POST 请求中 URL 参数里的 “callback” 部分，比如 {jsonp:’onJsonPLoad’} 会导致将 “onJsonPLoad=?” 传给服务器。</li>
</ul>
</li>
<li>jsonpCallback<ul>
<li>类型：String</li>
<li>为 jsonp 请求指定一个回调函数名。这个值将用来取代 jQuery 自动生成的随机函数名。这主要用来让 jQuery 生成度独特的函数名，这样管理请求更容易，也能方便地提供回调函数和错误处理。你也可以在想让浏览器缓存 GET 请求的时候，指定这个回调函数名。</li>
</ul>
</li>
<li>password<ul>
<li>类型：String</li>
<li>用于响应 HTTP 访问认证请求的密码</li>
</ul>
</li>
<li>processData<ul>
<li>类型：Boolean</li>
<li>默认值: true。默认情况下，通过data选项传递进来的数据，如果是一个对象(技术上讲只要不是字符串)，都会处理转化成一个查询字符串，以配合默认内容类型 “application/x-www-form-urlencoded”。如果要发送 DOM 树信息或其它不希望转换的信息，请设置为 false。</li>
</ul>
</li>
<li>scriptCharset<ul>
<li>类型：String</li>
<li>只有当请求时 dataType 为 “jsonp” 或 “script”，并且 type 是 “GET” 才会用于强制修改 charset。通常只在本地和远程的内容编码不同时使用。</li>
</ul>
</li>
<li>success<ul>
<li>类型：Function</li>
<li>请求成功后的回调函数。</li>
<li>参数：由服务器返回，并根据 dataType 参数进行处理后的数据；描述状态的字符串。</li>
<li>这是一个 Ajax 事件。</li>
</ul>
</li>
<li>traditional<ul>
<li>类型：Boolean</li>
<li>如果你想要用传统的方式来序列化数据，那么就设置为 true。请参考工具分类下面的 jQuery.param 方法。</li>
</ul>
</li>
<li>timeout<ul>
<li>类型：Number</li>
<li>设置请求超时时间（毫秒）。此设置将覆盖全局设置。</li>
</ul>
</li>
<li>type<ul>
<li>类型：String</li>
<li>默认值: “GET”)。请求方式 (“POST” 或 “GET”)， 默认为 “GET”。注意：其它 HTTP 请求方法，如 PUT 和 DELETE 也可以使用，但仅部分浏览器支持。</li>
</ul>
</li>
<li>url<ul>
<li>类型：String</li>
<li>默认值: 当前页地址。发送请求的地址。</li>
</ul>
</li>
<li>username<ul>
<li>类型：String</li>
<li>用于响应 HTTP 访问认证请求的用户名。</li>
</ul>
</li>
<li>xhr<ul>
<li>类型：Function</li>
<li>需要返回一个 XMLHttpRequest 对象。默认在 IE 下是 ActiveXObject 而其他情况下是 XMLHttpRequest 。用于重写或者提供一个增强的 XMLHttpRequest 对象。这个参数在 jQuery 1.3 以前不可用。</li>
</ul>
</li>
</ol>
<h5 id="2、回调函数"><a href="#2、回调函数" class="headerlink" title="2、回调函数"></a>2、回调函数</h5><p>如果要处理 <code>$.ajax()</code> 得到的数据，则需要使用回调函数：beforeSend、error、dataFilter、success、complete。</p>
<ul>
<li>beforeSend：在发送请求之前调用，并且传入一个 XMLHttpRequest 作为参数。</li>
<li>error：在请求出错时调用。传入 XMLHttpRequest 对象，描述错误类型的字符串以及一个异常对象（如果有的话）</li>
<li>dataFilter：在请求成功之后调用。传入返回的数据以及 “dataType” 参数的值。并且必须返回新的数据（可能是处理过的）传递给 success 回调函数。</li>
<li>success：当请求之后调用。传入返回后的数据，以及包含成功代码的字符串。</li>
<li>complete：当请求完成之后调用这个函数，无论成功或失败。传入 XMLHttpRequest 对象，以及一个包含成功或错误代码的字符串。</li>
</ul>
<h4 id="三、LT-ajax过程"><a href="#三、LT-ajax过程" class="headerlink" title="三、LT.ajax过程"></a>三、LT.ajax过程</h4><ul>
<li><p>c跨域请求sns</p>
<ol>
<li><p>第一次请求，判断有没有<code>that.proxies[hostname]</code>即<code>that.proxies[sns.lietou.com]</code>,没有<br><img src="http://chuantu.biz/t5/119/1498648032x2084677658.png" alt="avatar"></p>
</li>
<li><p>走<code>LT.Domain.init</code>,判断需要跨域执行<code>if(!that._crossed) that._cross()</code>,将域名从<code>c.liepin.com</code>降级为<code>liepin.com</code></p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">_cross: function() &#123;</div><div class="line">    try &#123;</div><div class="line">     document.domain =    </div><div class="line">      window.location.hostname.split(&apos;.&apos;).reverse().slice(0, 2).reverse().join(&apos;.&apos;);</div><div class="line">     this._crossed = true;</div><div class="line">  &#125; catch (e) &#123;&#125;</div><div class="line"> &#125;,</div></pre></td></tr></table></figure>
</li>
<li><p>创建一个iframe,iframe的链接是//sns.liepin.com/ajaxproxy.html，并将sns.liepin.com降级到liepin.com，同时设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">that.proxies[hostname] = iframe;</div><div class="line"> that.proxies[hostname].loaded = false;</div></pre></td></tr></table></figure>
<p>//sns.liepin.com/ajaxproxy.html中的内容：</p>
<p><img src="http://chuantu.biz/t5/119/1498647937x2084677658.png" alt="avatar"></p>
</li>
<li><p>如果iframe创建成功，并加载完毕(<code>that.proxies[hostname].loaded = true</code>)，走callback，重新执行<code>LT.Domain.use</code>,最后拿到sns.liepin.com的ajax实例化对象（…xhr），然后进行通讯<br><img src="http://chuantu.biz/t5/119/1498648195x2084677658.png" alt="avatar"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">    $.ajaxSetup(&#123;</div><div class="line">        crossDomain: false,</div><div class="line">        xhr: function() &#123;</div><div class="line">          if (this.dataType === &apos;script&apos;) return that.proxies.xhr();</div><div class="line">          if (that._root(this.url) === location.hostname) &#123;</div><div class="line">            return that.proxies.xhr();</div><div class="line">          &#125; else &#123;</div><div class="line">            return that.proxies[hostname].contentWindow.getTransport();</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;);</div><div class="line">      LT.ajaxExtend($.ajaxSettings, &apos;beforeSend&apos;, function (XHR) &#123;</div><div class="line">        XHR.setRequestHeader(&apos;X-Alt-Referer&apos;,location.href);</div><div class="line">      &#125;);</div><div class="line">      if (callback) callback.call(this);</div><div class="line">```</div></pre></td></tr></table></figure>
</li>
</ol>
<p>LT.ajaxExtend($.ajaxSettings, ‘beforeSend’, function (XHR) {</p>
<pre><code>  XHR.setRequestHeader(&apos;X-Alt-Referer&apos;,location.href);
});
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">  ![avatar](http://chuantu.biz/t5/119/1498648258x2084677658.png)</div><div class="line"></div><div class="line">  that.proxies[hostname].contentWindow.getTransport():</div><div class="line">![avatar](http://chuantu.biz/t5/119/1498647937x2084677658.png)</div><div class="line"></div><div class="line">![avatar](http://chuantu.biz/t5/120/1498702958x2890171701.png)</div><div class="line">  扩展：创建 XMLHttpRequest 对象</div><div class="line">  </div><div class="line">  1. 创建 XMLHttpRequest 对象的语法：</div></pre></td></tr></table></figure>
<pre><code>xmlhttp=new XMLHttpRequest();
</code></pre>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">2. 老版本的 Internet Explorer （IE5 和 IE6）使用 ActiveX 对象：</div></pre></td></tr></table></figure>
<pre><code>xmlhttp=new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);
</code></pre><p>   ```</p>
</li>
</ul>
<h3 id="四、LT-ajax、jsonp、ajaxfileupload对比"><a href="#四、LT-ajax、jsonp、ajaxfileupload对比" class="headerlink" title="四、LT.ajax、jsonp、ajaxfileupload对比"></a>四、LT.ajax、jsonp、ajaxfileupload对比</h3><h4 id="一、ajaxfileupload的原理"><a href="#一、ajaxfileupload的原理" class="headerlink" title="一、ajaxfileupload的原理"></a>一、ajaxfileupload的原理</h4><ol>
<li>先创建一个表单，上传图片的表单<br><img src="http://chuantu.biz/t5/120/1498714064x2084677658.png" alt="avatar"></li>
<li>再创建一个iframe<br><img src="http://chuantu.biz/t5/120/1498722260x2084677658.png" alt="avatar"></li>
<li><p>将表单的action设置为图片上传的地址，target设置为新建的iframe的id，即在指定的框架中打开。<br><img src="http://chuantu.biz/t5/120/1498722132x2084677658.png" alt="avatar"></p>
<p><img src="http://chuantu.biz/t5/120/1498721983x2084677658.png" alt="avatar"></p>
</li>
</ol>
<h4 id="二、LT-ajax、jsonp、ajaxfileupload原理对比"><a href="#二、LT-ajax、jsonp、ajaxfileupload原理对比" class="headerlink" title="二、LT.ajax、jsonp、ajaxfileupload原理对比"></a>二、LT.ajax、jsonp、ajaxfileupload原理对比</h4><ul>
<li><p>LT跨域：比如c跨域到sns</p>
<p>降级c域的domain，创建一个iframe,iframe的链接是//sns.liepin.com/ajaxproxy.html，同时将c.liepin.com降级到liepin.com。然后拿到sns域的ajax对象实例（…xhr），最终实现跨域请求，，最后return回去的是一个已经降级的domain,这样的话，如果再进行jsonp的跨域请求，就会出问题</p>
</li>
<li>jsonp：跨域<br>通过创建一个script标签，改变script标签的src，通过注册的callback返回参数实现（src是可以跨域的）</li>
<li><p>ajaxfileupload：</p>
<p>是一个form提交，创建一个iframe,将要提交的表单拷贝一份放在iframe。</p>
<blockquote>
<p>参考文档：</p>
<p><a href="http://www.cnblogs.com/nanpingwanzhong/archive/2012/12/22/2828885.html" target="_blank" rel="external">html5 XHR2 and CORS</a></p>
<p><a href="http://www.w3school.com.cn/jquery/ajax_ajax.asp" target="_blank" rel="external">w3school jQuery ajax-ajax() 方法</a></p>
<p><a href="http://www.jb51.net/article/70673.htm" target="_blank" rel="external">javascript跨域方法、原理以及出现问题解决方法（详解）</a></p>
</blockquote>
</li>
</ul>
<hr>
<p><em>author: zhanggz</em></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Javascript/" rel="tag"># Javascript</a>
          
            <a href="/tags/web开发/" rel="tag"># web开发</a>
          
            <a href="/tags/AJAX/" rel="tag"># AJAX</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/06/23/sublime-tools1/" rel="next" title="前端工作流-Sublime同步刷新浏览器&分屏操作">
                <i class="fa fa-chevron-left"></i> 前端工作流-Sublime同步刷新浏览器&分屏操作
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="Jing" />
          <p class="site-author-name" itemprop="name">Jing</p>
           
              <p class="site-description motion-element" itemprop="description">不忘初心，方得始终。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、AJAX-跨域"><span class="nav-number">1.</span> <span class="nav-text">一、AJAX 跨域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、AJAX跨域解决方案"><span class="nav-number">2.</span> <span class="nav-text">二、AJAX跨域解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一、代理"><span class="nav-number">2.1.</span> <span class="nav-text">一、代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二、XHR2"><span class="nav-number">2.2.</span> <span class="nav-text">二、XHR2</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-XMLHttpRequest-Level2-背景"><span class="nav-number">2.2.1.</span> <span class="nav-text">1.XMLHttpRequest Level2 背景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-CORS"><span class="nav-number">2.2.2.</span> <span class="nav-text">2. CORS</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-实现"><span class="nav-number">2.2.3.</span> <span class="nav-text">3. 实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三、jsonp"><span class="nav-number">2.3.</span> <span class="nav-text">三、jsonp</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-Jsonp原理："><span class="nav-number">2.3.1.</span> <span class="nav-text">1.Jsonp原理：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-json-与jsonp的区别"><span class="nav-number">2.3.2.</span> <span class="nav-text">2.json 与jsonp的区别:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-Jsonp跨域实现："><span class="nav-number">2.3.3.</span> <span class="nav-text">3.Jsonp跨域实现：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、LT-Ajax"><span class="nav-number">3.</span> <span class="nav-text">三、LT.Ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一、ajaxSettings"><span class="nav-number">3.1.</span> <span class="nav-text">一、ajaxSettings</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二、jQuery-ajax"><span class="nav-number">3.2.</span> <span class="nav-text">二、jQuery.ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1、参数"><span class="nav-number">3.2.1.</span> <span class="nav-text">1、参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2、回调函数"><span class="nav-number">3.2.2.</span> <span class="nav-text">2、回调函数</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三、LT-ajax过程"><span class="nav-number">3.3.</span> <span class="nav-text">三、LT.ajax过程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、LT-ajax、jsonp、ajaxfileupload对比"><span class="nav-number">4.</span> <span class="nav-text">四、LT.ajax、jsonp、ajaxfileupload对比</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一、ajaxfileupload的原理"><span class="nav-number">4.1.</span> <span class="nav-text">一、ajaxfileupload的原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二、LT-ajax、jsonp、ajaxfileupload原理对比"><span class="nav-number">4.2.</span> <span class="nav-text">二、LT.ajax、jsonp、ajaxfileupload原理对比</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jing</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
